# CLI Тестовый модуль для API запросов

CLI приложение для тестирования различных API запросов с удобным интерфейсом и поддержкой валютного калькулятора.

## Возможности

- **GET/POST запросы** к любым API endpoints
- **Информация о странах** с красивым форматированием (REST Countries API)
- **Случайные изображения собак** (Dog CEO API)
- **Валютный калькулятор** с кэшированием курсов валют (ExchangeRate API)
  - Конвертация валют
  - Просмотр доступных валют
  - Просмотр курсов валют
  - Обновление курсов валют
- **Погода** (OpenWeatherMap API)
  - Погода по названию города
  - Погода по координатам
  - Прогноз на 5 дней вперед
  - Расширенные данные (погода + качество воздуха)
  - Кэширование последних 10 запросов
  - Автоматическое использование кэша при недоступности API

## Требования

- Python 3.7+
- pip (менеджер пакетов Python)

## Установка

### 1. Клонирование или скачивание проекта

```bash
cd /home/chernyak/AI_projects/api_test
```

### 2. Создание виртуального окружения

```bash
python3 -m venv venv
```

### 3. Активация виртуального окружения

**Linux/Mac:**
```bash
source venv/bin/activate
```

**Windows:**
```bash
venv\Scripts\activate
```

### 4. Настройка API ключа для погоды

Создайте файл `.env` в корне проекта на основе `.env.example`:

```bash
cp .env.example .env
```

Откройте `.env` и укажите ваш API ключ от OpenWeatherMap:

```
API_KEY=ваш_api_ключ_здесь
```

Получить API ключ можно на [https://openweathermap.org/api](https://openweathermap.org/api) (требуется бесплатная регистрация).

### 5. Установка зависимостей

```bash
pip install -r requirements.txt
```

Это установит следующие пакеты:
- `requests` - для HTTP запросов
- `colorama` - для цветного вывода в консоли
- `python-dotenv` - для загрузки переменных окружения из .env файла

## Запуск программы

После активации виртуального окружения:

```bash
python main.py
```

Или напрямую (без активации venv):

```bash
./venv/bin/python main.py
```

## Структура проекта

```
api_test/
├── main.py                 # Главный файл с CLI меню
├── http_client.py          # Модуль для HTTP запросов
├── country_formatter.py    # Форматирование информации о странах
├── currency.py             # Логика валютного калькулятора
├── storage.py              # Модуль для работы с файлами (I/O)
├── weather_app.py          # Модуль для работы с погодным API
├── currency_rate.json      # Кэш курсов валют (создается автоматически)
├── weather_cache.json      # Кэш погодных данных (создается автоматически)
├── .env                    # Файл с API ключами (создается пользователем)
├── .env.example            # Пример файла с переменными окружения
├── requirements.txt        # Зависимости проекта
├── README.md              # Документация
├── doc/                    # Документация API
│   └── pollution_api_response.txt  # Пример ответа API качества воздуха
└── venv/                  # Виртуальное окружение (создается при установке)
```

## Использование

### Главное меню

После запуска программы вы увидите главное меню:

```
============================================================
          CLI ТЕСТОВЫЙ МОДУЛЬ ДЛЯ API ЗАПРОСОВ
============================================================
1 - GET по URL
2 - Страна
3 - Случайная собака
4 - Валютный калькулятор
5 - Узнать погоду
0 - Выход
============================================================
```

### 1. GET по URL

Позволяет выполнить GET запрос к любому URL.

**Пример использования:**
- Выберите пункт `1`
- Введите URL, например: `https://api.github.com/users/octocat`
- Программа выведет JSON ответ с красивым форматированием и цветами

### 2. Страна

Получение подробной информации о стране через REST Countries API.

**Пример использования:**
- Выберите пункт `2`
- Введите название страны: `Spain` или `Испания`
- Программа выведет структурированную информацию:
  - Основная информация (название, столица, коды)
  - География (регион, площадь, координаты, границы)
  - Демография (население)
  - Экономика (валюты)
  - Языки
  - Временные зоны
  - И многое другое

**Поддерживаемые форматы:**
- Английское название (Spain, France, Germany)
- Русское название (Испания, Франция, Германия)

### 3. Случайная собака

Получение случайного изображения собаки через Dog CEO API.

**Пример использования:**
- Выберите пункт `3`
- Программа автоматически получит случайное изображение и выведет ссылку на него

### 4. Валютный калькулятор

Полнофункциональный валютный калькулятор с поддержкой следующих валют:
- **USD** - Доллар США
- **EUR** - Евро
- **GBP** - Фунт стерлингов
- **RUB** - Российский рубль
- **CNY** - Китайский юань

#### Подменю валютного калькулятора

После выбора пункта `4` появится подменю:

```
============================================================
       ВАЛЮТНЫЙ КАЛЬКУЛЯТОР
============================================================
1 - Конвертировать валюту
2 - Показать доступные валюты
3 - Показать курсы
4 - Обновить курсы валют
0 - Выход в основное меню
============================================================
```

##### 1. Конвертировать валюту

Конвертация суммы из одной валюты в другую.

**Пример использования:**
- Выберите пункт `1` в подменю калькулятора
- Введите сумму: `100`
- Введите код исходной валюты: `USD`
- Введите код целевой валюты: `RUB`
- Результат выводится с точностью до 4 знаков после запятой

**Пример вывода:**
```
==============================================================
                 РЕЗУЛЬТАТ КОНВЕРТАЦИИ
==============================================================

100.00 USD = 9200.5000 RUB
```

##### 2. Показать доступные валюты

Выводит список всех поддерживаемых валют.

**Пример вывода:**
```
==============================================================
                  ДОСТУПНЫЕ ВАЛЮТЫ
==============================================================

1. USD
2. EUR
3. GBP
4. RUB
5. CNY
```

##### 3. Показать курсы

Показывает курсы всех поддерживаемых валют относительно выбранной базовой валюты.

**Пример использования:**
- Выберите пункт `3`
- Введите код базовой валюты: `USD`
- Программа выведет курсы всех остальных валют относительно USD

**Пример вывода:**
```
======================================================================
                         КУРСЫ ВАЛЮТ
======================================================================

Базовая валюта: USD

──────────────────────────────────────────────────────────────────────
CNY   →          7.2500
EUR   →          0.9200
GBP   →          0.7900
RUB   →         92.5000
──────────────────────────────────────────────────────────────────────
```

##### 4. Обновить курсы валют

Принудительно обновляет курсы валют через API и сохраняет их в файл `currency_rate.json`.

**Пример использования:**
- Выберите пункт `4`
- Введите код базовой валюты: `USD`
- Программа выполнит запрос к API и обновит кэш

**Важно:** Курсы автоматически обновляются только если:
- Файл `currency_rate.json` не существует
- Дата в файле не совпадает с текущей датой
- Изменена базовая валюта

В остальных случаях данные берутся из кэша для экономии API запросов.

### 5. Узнать погоду

Получение актуальной информации о погоде через OpenWeatherMap API.

**Требования:** Необходимо настроить API ключ в файле `.env` (см. раздел "Установка").

#### Подменю погоды

После выбора пункта `5` появится подменю:

```
============================================================
       ПОГОДА
============================================================
1 - Погода по названию города
2 - Погода по координатам
3 - Прогноз на 5 дней вперед
4 - Расширенные данные
0 - Выход в основное меню
============================================================
```

##### 1. Погода по названию города

Получение погоды по названию города.

**Пример использования:**
- Выберите пункт `1` в подменю погоды
- Введите название города: `Турин` или `Turin`
- Программа выведет информацию о погоде

**Пример вывода:**
```
======================================================================
                    ПОГОДА В ГОРОДЕ
======================================================================

Погода в городе Турин: 8.25°C, пасмурно
Координаты города Турин (код страны: IT)
широта = 45.133
долгота = 7.367
```

##### 2. Погода по координатам

Получение погоды по географическим координатам.

**Пример использования:**
- Выберите пункт `2` в подменю погоды
- Введите широту: `45.133`
- Введите долготу: `7.367`
- Программа выведет информацию о погоде

**Пример вывода:**
```
======================================================================
                  ПОГОДА ПО КООРДИНАТАМ
======================================================================

широта = 45.133
долгота = 7.367
Код страны: IT
Название населенного пункта: Turin
```

##### 3. Прогноз на 5 дней вперед

Получение детального прогноза погоды на 5 дней с интервалом 3 часа.

**Пример использования:**
- Выберите пункт `3` в подменю погоды
- Введите название города: `Москва`
- Программа выведет список из 5 дат для выбора
- Выберите дату из списка
- Программа выведет детальный прогноз по часам для выбранной даты

**Пример вывода:**
```
======================================================================
                  ПОДРОБНЫЙ ПРОГНОЗ
======================================================================

Город: Москва
Дата: 15.01.2026 - Четверг

02:00:  -5.32°C, Пасмурно
05:00:  -7.32°C, Облачно с прояснениями
08:00:  -10.32°C, Переменная облачность
11:00:  -10.72°C, Переменная облачность
14:00:  -15.32°C, Солнечно
17:00:  -15.92°C, Переменная облачность
20:00:  -15.32°C, Пасмурно
23:00:  -15.32°C, Пасмурно
```

##### 4. Расширенные данные

Получение расширенной информации о погоде и качестве воздуха.

**Пример использования:**
- Выберите пункт `4` в подменю погоды
- Выберите способ ввода: по названию города или по координатам
- Введите необходимые данные
- Программа выведет расширенные данные о погоде и качестве воздуха

**Пример вывода:**
```
======================================================================
                РАСШИРЕННЫЕ ДАННЫЕ О ПОГОДЕ
======================================================================

Город: Москва

Температура: -6.84°C
Влажность: 66%
Давление: 1017 гПа
Ветер: 10 м/с
Видимость:  10.0 км
Восход солнца: 10:00
Закат солнца:  18:00
UV индекс: 4.0 (Умеренный)

Качество воздуха:
Общий статус воздуха: Удовлетворительно
Превышение нормы: O3 : 73.06 мкг/м3 - Удовлетворительно
 Условия: Небольшая облачность
```

**Данные о погоде включают:**
- Температура
- Влажность
- Давление
- Ветер (скорость)
- Видимость
- Восход и закат солнца
- UV индекс с определением уровня

**Данные о качестве воздуха включают:**
- Общий статус воздуха (на основе худшего показателя)
- Превышение нормы (показывается компонент с худшим показателем)
- Условия (описание погоды)

**Анализ качества воздуха:**
Система анализирует следующие компоненты:
- **SO2** (Диоксид серы)
- **NO2** (Диоксид азота)
- **PM10** (Частицы диаметром до 10 мкм)
- **PM2.5** (Частицы диаметром до 2.5 мкм)
- **O3** (Озон)
- **CO** (Оксид углерода)

Каждый компонент сравнивается с нормами и определяется уровень качества воздуха:
- **Хорошо** (Index 1)
- **Удовлетворительно** (Index 2)
- **Умеренно** (Index 3)
- **Плохо** (Index 4)
- **Очень плохо** (Index 5)

Общий статус определяется на основе худшего показателя среди всех компонентов.

#### Особенности работы с погодой

**Кэширование:**
- Система автоматически сохраняет последние 10 успешных запросов к API
- При добавлении новой записи самая старая удаляется (механизм ротации)
- Кэш сохраняется в файл `weather_cache.json`

**Обработка ошибок:**
- При недоступности API система делает до 3 попыток с экспоненциальной задержкой (1s, 2s, 4s)
- После неудачных попыток пользователю предлагается использовать данные из кэша
- При согласии система ищет в кэше данные по запросу пользователя (город или координаты)
- Если данные найдены - выводится самый свежий результат из кэша
- Если данных нет - выводится соответствующее сообщение

**Retry механизм:**
- Автоматические повторы при ошибках 429 (Too Many Requests) и 5xx (серверные ошибки)
- Повторы при сетевых ошибках (ConnectionError, Timeout)
- Максимум 3 попытки с экспоненциальной задержкой

### 0. Выход

Завершает работу программы.

## Особенности реализации

### Кэширование курсов валют

- Данные о курсах валют сохраняются в файл `currency_rate.json`
- Файл создается автоматически при первом запуске
- Курсы обновляются автоматически только при необходимости (смена даты или валюты)
- Принудительное обновление доступно через пункт меню "Обновить курсы валют"

### Кэширование погодных данных

- Данные о погоде сохраняются в файл `weather_cache.json`
- Файл создается автоматически при первом запросе погоды
- Сохраняются последние 10 успешных запросов к API
- При добавлении новой записи самая старая удаляется (механизм ротации)
- Кэш используется только при недоступности API после всех попыток retry
- Поиск в кэше осуществляется по городу или координатам запроса пользователя

### Форматирование вывода

- Все JSON ответы выводятся с красивым форматированием и цветами
- Используется библиотека `colorama` для поддержки цветов в разных терминалах
- Информация о странах выводится с русифицированными названиями полей

### Обработка ошибок

- Все ошибки обрабатываются и выводятся в понятном для пользователя виде
- Нет падения программы со стектрейсом
- Понятные сообщения об ошибках на русском языке

### Модульная архитектура

- `http_client.py` - единая точка для всех HTTP запросов
- `storage.py` - работа с файлами (чтение/запись)
- `currency.py` - бизнес-логика валютного калькулятора
- `country_formatter.py` - форматирование данных о странах
- `weather_app.py` - работа с погодным API и кэшированием
- `main.py` - CLI интерфейс и координация модулей

## Примеры использования

### Пример 1: Получение информации о стране

```
Выберите действие: 2
Введите название страны: Japan
```

Выведет подробную информацию о Японии с красивым форматированием.

### Пример 2: Конвертация валют

```
Выберите действие: 4
Выберите действие: 1
Введите сумму: 50
Введите код исходной валюты: EUR
Введите код целевой валюты: GBP
```

Результат: `50.00 EUR = 42.9500 GBP`

### Пример 3: Просмотр курсов

```
Выберите действие: 4
Выберите действие: 3
Введите код базовой валюты: RUB
```

Выведет все курсы валют относительно российского рубля.

### Пример 4: Прогноз погоды на 5 дней

```
Выберите действие: 5
Выберите действие: 3
Введите название города: Москва
Выберите дату (1-5): 1
```

Выведет детальный прогноз погоды по часам для выбранной даты.

### Пример 5: Расширенные данные о погоде

```
Выберите действие: 5
Выберите действие: 4
Выберите способ: 1
Введите название города: Москва
```

Выведет расширенную информацию о погоде и качестве воздуха.

## API Endpoints

Программа использует следующие публичные API:

- **REST Countries API**: `https://restcountries.com/v3.1/name/{country}` (без API ключа)
- **Dog CEO API**: `https://dog.ceo/api/breeds/image/random` (без API ключа)
- **ExchangeRate API**: `https://open.er-api.com/v6/latest/{base}` (без API ключа)
- **OpenWeatherMap API**: 
  - Current Weather: `https://api.openweathermap.org/data/2.5/weather` (требует API ключ)
  - Forecast (5 days): `https://api.openweathermap.org/data/2.5/forecast` (требует API ключ)
  - Geocoding: `https://api.openweathermap.org/geo/1.0/direct` (требует API ключ)
  - Air Pollution: `https://api.openweathermap.org/data/2.5/air_pollution` (требует API ключ)

## Решение проблем

### Ошибка "ModuleNotFoundError"

Убедитесь, что:
1. Виртуальное окружение активировано
2. Все зависимости установлены: `pip install -r requirements.txt`

### Ошибка "Ошибка при получении курсов валют"

Возможные причины:
- Проблемы с интернет-соединением
- API временно недоступно
- Неверный код валюты

### Файл currency_rate.json не создается

Файл создается автоматически при первом запросе курсов валют. Если файл не создается, проверьте права на запись в директорию проекта.

### Ошибка "API ключ не найден" при запросе погоды

Убедитесь, что:
1. Файл `.env` создан в корне проекта
2. В файле `.env` указан корректный API ключ: `API_KEY=ваш_ключ`
3. API ключ получен на [openweathermap.org](https://openweathermap.org/api)

### Ошибка "Сетевая ошибка" при запросе погоды

При недоступности API система автоматически предложит использовать данные из кэша. Если в кэше нет данных для вашего запроса, убедитесь, что:
- У вас есть интернет-соединение
- API OpenWeatherMap доступен
- API ключ действителен и не превышен лимит запросов

### Ошибка "Город с таким названием не найден"

Убедитесь, что:
- Название города введено корректно
- Попробуйте использовать английское название города
- Проверьте правильность написания (регистр не важен)

### UV индекс показывает "N/A" или "0.0"

UV индекс не всегда доступен в стандартном ответе Current Weather API. Для получения актуального UV индекса может потребоваться отдельный API запрос. В текущей версии используется значение из ответа API, если оно доступно.

## Разработка

Для разработчиков:

- Все функции документированы docstrings
- Код следует PEP 8 стилю
- Типизация с использованием type hints
- Обработка ошибок на всех уровнях

## Лицензия

Этот проект создан в образовательных целях.

## Автор

Проект создан для тестирования API и демонстрации работы с HTTP запросами, файловым I/O и CLI интерфейсами.

